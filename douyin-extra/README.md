# æŠ–éŸ³ç›´æ’­è§†é¢‘æå–å™¨ (Douyin Live Recorder)

[![Java](https://img.shields.io/badge/Java-17-orange.svg)](https://www.oracle.com/java/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.1-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

ä¸€ä¸ªåŸºäºSpring Bootçš„REST APIæœåŠ¡ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹ã€æå–å’Œå½•åˆ¶æŠ–éŸ³ç›´æ’­æµä¸ºMP4è§†é¢‘æ–‡ä»¶ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **è‡ªåŠ¨æ£€æµ‹ç›´æ’­çŠ¶æ€** - å®æ—¶æ£€æµ‹æŠ–éŸ³ç”¨æˆ·æ˜¯å¦æ­£åœ¨ç›´æ’­
- âœ… **æ™ºèƒ½æµæå–** - è‡ªåŠ¨è·å–æœ€ä½³è´¨é‡çš„ç›´æ’­æµURL
- âœ… **é«˜è´¨é‡å½•åˆ¶** - ä½¿ç”¨FFmpegå½•åˆ¶ä¸ºMP4æ ¼å¼ï¼Œä¿æŒåŸå§‹è´¨é‡
- âœ… **å¹¶å‘å½•åˆ¶** - æ”¯æŒåŒæ—¶å½•åˆ¶å¤šä¸ªç›´æ’­é—´ï¼ˆé»˜è®¤æœ€å¤š5ä¸ªï¼‰
- âœ… **å®æ—¶ç›‘æ§** - æŸ¥è¯¢å½•åˆ¶çŠ¶æ€ã€è¿›åº¦å’Œæ–‡ä»¶å¤§å°
- âœ… **ä¼˜é›…åœæ­¢** - å®‰å…¨åœæ­¢å½•åˆ¶å¹¶ä¿å­˜å·²å½•åˆ¶å†…å®¹
- âœ… **å®Œæ•´æ—¥å¿—** - è¯¦ç»†çš„æ“ä½œæ—¥å¿—å’Œé”™è¯¯è¿½è¸ª
- âœ… **å¥åº·æ£€æŸ¥** - ç›‘æ§FFmpegå’Œå­˜å‚¨ç©ºé—´çŠ¶æ€
- âœ… **RESTful API** - æ ‡å‡†çš„HTTPæ¥å£ï¼Œæ˜“äºé›†æˆ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|---------|------|
| Java | 17+ | [ä¸‹è½½åœ°å€](https://www.oracle.com/java/technologies/downloads/) |
| Maven | 3.6+ | [ä¸‹è½½åœ°å€](https://maven.apache.org/download.cgi) |
| FFmpeg | æœ€æ–°ç‰ˆ | [ä¸‹è½½åœ°å€](https://ffmpeg.org/download.html) âš ï¸ **å¿…éœ€** |

### å®‰è£…FFmpegï¼ˆé‡è¦ï¼ï¼‰

#### Windows
```bash
# 1. ä¸‹è½½FFmpeg: https://www.gyan.dev/ffmpeg/builds/
# 2. è§£å‹åˆ° C:\ffmpeg
# 3. æ·»åŠ  C:\ffmpeg\bin åˆ°ç³»ç»ŸPATHç¯å¢ƒå˜é‡
# 4. éªŒè¯å®‰è£…
ffmpeg -version
```

#### Linux
```bash
sudo apt install ffmpeg  # Ubuntu/Debian
# æˆ–
sudo yum install ffmpeg  # CentOS/RHEL
```

#### macOS
```bash
brew install ffmpeg
```

### å¯åŠ¨é¡¹ç›®

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨Mavenè¿è¡Œï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰
mvnw.cmd spring-boot:run  # Windows
./mvnw spring-boot:run     # Linux/macOS

# æ–¹å¼äºŒï¼šæ‰“åŒ…åè¿è¡Œï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰
mvn clean package
java -jar target/douyin-live-recorder-1.0.0.jar
```

çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š
```
Started LiveRecorderApplication in X.XXX seconds
```

æœåŠ¡åœ°å€ï¼š`http://localhost:8080`

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### 1. å¼€å§‹å½•åˆ¶

```bash
curl -X POST http://localhost:8080/api/recordings/start \
  -H "Content-Type: application/json" \
  -d '{"douyinId": "w2511839220", "outputDir": "D:\\recordings"}'
```

**å“åº”ï¼š**
```json
{
  "taskId": "550e8400-e29b-41d4-a716-446655440000",
  "douyinId": "w2511839220",
  "status": "DETECTING",
  "startTime": "2026-01-03T14:30:25"
}
```

### 2. æŸ¥è¯¢å½•åˆ¶çŠ¶æ€

```bash
curl http://localhost:8080/api/recordings/550e8400-e29b-41d4-a716-446655440000/status
```

**å“åº”ï¼š**
```json
{
  "taskId": "550e8400-e29b-41d4-a716-446655440000",
  "status": "RECORDING",
  "progress": {
    "duration": 120,
    "fileSize": 15728640,
    "bitrate": "1024kbps"
  }
}
```

### 3. åœæ­¢å½•åˆ¶

```bash
curl -X POST http://localhost:8080/api/recordings/550e8400-e29b-41d4-a716-446655440000/stop
```

### 4. æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡

```bash
curl http://localhost:8080/api/recordings
```

## ğŸ“š å®Œæ•´æ–‡æ¡£

- **[å¿«é€Ÿå¼€å§‹æŒ‡å—](QUICK_START.md)** - 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
- **[å®Œæ•´ä½¿ç”¨æ‰‹å†Œ](USER_MANUAL.md)** - è¯¦ç»†çš„APIæ–‡æ¡£ã€é…ç½®è¯´æ˜å’Œæ•…éšœæ’æŸ¥

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Spring Boot 3.2.1
- **ç¼–ç¨‹è¯­è¨€**: Java 17
- **è§†é¢‘å¤„ç†**: FFmpeg
- **HTTPå®¢æˆ·ç«¯**: OkHttp 4.12.0
- **æ—¥å¿—æ¡†æ¶**: SLF4J + Logback
- **æµ‹è¯•æ¡†æ¶**: JUnit 5 + jqwik (å±æ€§æµ‹è¯•)
- **æ„å»ºå·¥å…·**: Maven

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      API/æœåŠ¡æ¥å£å±‚                  â”‚
â”‚  (æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œè¿”å›çŠ¶æ€)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ä¸šåŠ¡é€»è¾‘å±‚                      â”‚
â”‚  - å½•åˆ¶ç®¡ç†å™¨                        â”‚
â”‚  - ä»»åŠ¡è°ƒåº¦å™¨                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ ¸å¿ƒæœåŠ¡å±‚                      â”‚
â”‚  - ç›´æ’­æ£€æµ‹æœåŠ¡                      â”‚
â”‚  - æµæå–æœåŠ¡                        â”‚
â”‚  - å½•åˆ¶æœåŠ¡                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åŸºç¡€è®¾æ–½å±‚                      â”‚
â”‚  - HTTPå®¢æˆ·ç«¯                        â”‚
â”‚  - FFmpegåŒ…è£…å™¨                      â”‚
â”‚  - æ–‡ä»¶ç³»ç»Ÿç®¡ç†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ java/com/douyin/liverecorder/
â”‚   â”‚   â”œâ”€â”€ controller/          # REST APIæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ service/             # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ RecordingManager.java      # å½•åˆ¶ç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ LiveStreamDetector.java    # ç›´æ’­æ£€æµ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ StreamExtractor.java       # æµæå–
â”‚   â”‚   â”‚   â””â”€â”€ RecordingService.java      # å½•åˆ¶æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ model/               # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ dto/                 # è¯·æ±‚/å“åº”å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ infrastructure/      # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ FFmpegWrapper.java         # FFmpegå°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ FileSystemManager.java     # æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ HttpClientUtil.java        # HTTPå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ exception/           # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ validation/          # è¾“å…¥éªŒè¯
â”‚   â”‚   â””â”€â”€ config/              # é…ç½®ç±»
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ application.properties         # åº”ç”¨é…ç½®
â”‚       â””â”€â”€ logback-spring.xml            # æ—¥å¿—é…ç½®
â””â”€â”€ test/
    â””â”€â”€ java/com/douyin/liverecorder/
        â”œâ”€â”€ controller/          # æ§åˆ¶å™¨æµ‹è¯•
        â”œâ”€â”€ service/             # æœåŠ¡æµ‹è¯•
        â”œâ”€â”€ infrastructure/      # åŸºç¡€è®¾æ–½æµ‹è¯•
        â”œâ”€â”€ validation/          # éªŒè¯æµ‹è¯•
        â”œâ”€â”€ integration/         # é›†æˆæµ‹è¯•
        â””â”€â”€ *PropertyTest.java   # å±æ€§æµ‹è¯•ï¼ˆjqwikï¼‰
```

## ğŸ”§ é…ç½®è¯´æ˜

ä¸»è¦é…ç½®é¡¹ï¼ˆ`application.properties`ï¼‰ï¼š

```properties
# æœåŠ¡ç«¯å£
server.port=8080

# å½•åˆ¶æ–‡ä»¶å­˜å‚¨è·¯å¾„
recording.storage.path=./recordings

# æœ€å¤§å¹¶å‘å½•åˆ¶ä»»åŠ¡æ•°
recording.max-concurrent-tasks=5

# FFmpegå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
ffmpeg.path=ffmpeg

# æ—¥å¿—çº§åˆ«
logging.level.com.douyin.liverecorder=DEBUG
```

## ğŸ§ª æµ‹è¯•

é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œå•å…ƒæµ‹è¯•
mvn test -Dtest=*Test

# è¿è¡Œå±æ€§æµ‹è¯•
mvn test -Dtest=*PropertyTest

# è¿è¡Œé›†æˆæµ‹è¯•
mvn test -Dtest=*IntegrationTest
```

**æµ‹è¯•è¦†ç›–ï¼š**
- âœ… 88ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… 7ä¸ªå±æ€§æµ‹è¯•ï¼ˆæ¯ä¸ª100+æ¬¡è¿­ä»£ï¼‰
- âœ… å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€å±æ€§æµ‹è¯•å…¨è¦†ç›–

## ğŸ“Š API æ¥å£

### åŸºç¡€URL
```
http://localhost:8080/api/recordings
```

### æ¥å£åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/start` | å¼€å§‹å½•åˆ¶ç›´æ’­ |
| POST | `/{taskId}/stop` | åœæ­¢å½•åˆ¶ |
| GET | `/{taskId}/status` | æŸ¥è¯¢å½•åˆ¶çŠ¶æ€ |
| GET | `/` | åˆ—å‡ºæ‰€æœ‰å½•åˆ¶ä»»åŠ¡ |
| GET | `/actuator/health` | å¥åº·æ£€æŸ¥ |

è¯¦ç»†çš„APIæ–‡æ¡£è¯·æŸ¥çœ‹ [USER_MANUAL.md](USER_MANUAL.md)

## â“ å¸¸è§é—®é¢˜

### FFmpegä¸å¯ç”¨
ç¡®ä¿FFmpegå·²å®‰è£…å¹¶åœ¨ç³»ç»ŸPATHä¸­ï¼š
```bash
ffmpeg -version
```

### ç›´æ’­æœªå¼€å§‹
ç¡®è®¤è¯¥æŠ–éŸ³å·å½“å‰æ­£åœ¨ç›´æ’­ï¼Œå¹¶æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚

### å¹¶å‘é™åˆ¶
å½“å‰å·²è¾¾åˆ°æœ€å¤§å¹¶å‘æ•°ï¼ˆé»˜è®¤5ä¸ªï¼‰ï¼Œç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆæˆ–ä¿®æ”¹é…ç½®ï¼š
```properties
recording.max-concurrent-tasks=10
```

### å½•åˆ¶æ–‡ä»¶ä½ç½®
é»˜è®¤ä½ç½®ï¼š`./recordings/`  
æ–‡ä»¶æ ¼å¼ï¼š`{æŠ–éŸ³å·}_{æ—¥æœŸ}_{æ—¶é—´}.mp4`

æ›´å¤šé—®é¢˜è¯·æŸ¥çœ‹ [USER_MANUAL.md](USER_MANUAL.md#å¸¸è§é—®é¢˜)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’Œå¹³å°æœåŠ¡æ¡æ¬¾ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [Spring Bootå®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [FFmpegå®˜æ–¹æ–‡æ¡£](https://ffmpeg.org/documentation.html)
- [jqwikå±æ€§æµ‹è¯•](https://jqwik.net/)

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼**
