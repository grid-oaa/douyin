# 实现计划：douyin-extra mp4save

## 概述
本计划将“录制前选择保存目录、记住上次目录、取消不创建任务”的设计落实为前后端改动与测试任务，确保流程可控且可追溯。

## 任务
- [x] 1. 设置项目结构和依赖（不新增第三方依赖） _需求：需求1.1、需求2.1_
  - [x] 1.1 前端新增本地存储常量键与读取/写入封装
  - [x] 1.2 复用现有 API 与 store 结构，避免新增库
- [x] 2. 数据模型和枚举调整 _需求：需求1.2_
  - [x] 2.1 前端 `StartRecordingRequest` 增加 `outputDir` 字段
  - [x] 2.2 后端 `StartRecordingRequest` 增加 `outputDir` 字段
- [x] 3. 基础设施层支持自定义保存目录校验 _需求：需求1.2、需求1.3_
  - [x] 3.1 在文件系统工具中新增目录可写性校验方法
  - [x] 3.2 统一输出路径拼接与目录存在性判断
- [x] 4. 核心服务层适配保存路径 _需求：需求1.2_
  - [x] 4.1 录制服务使用基于 `outputDir` 生成的最终输出路径
- [x] 5. 业务逻辑层串联目录选择与任务创建 _需求：需求1.1、需求1.2、需求3.1_
  - [x] 5.1 前端创建流程：先弹目录选择器，确认后再调用创建接口
  - [x] 5.2 录制管理层基于 `outputDir` 生成唯一文件名
- [x] 6. 检查点：核心流程联调验证 _需求：需求1.2、需求3.2_
  - [x] 6.1 确认创建成功后任务列表新增且输出路径正确
- [x] 7. 错误处理与提示完善 _需求：需求1.3、需求3.1_
  - [x] 7.1 前端：目录为空/取消时提示并中止流程
  - [x] 7.2 后端：目录为空或不可写返回明确错误码
- [x] 8. API 接口层改造 _需求：需求1.2_
  - [x] 8.1 Controller 接收并校验 `outputDir`
  - [x] 8.2 接口文档与前端调用参数同步更新
- [x] 9. 输入验证 _需求：需求1.3_
  - [x] 9.1 `outputDir` 非空校验
  - [x] 9.2 `outputDir` 可写目录校验
- [x] 10. 日志和监控 _需求：需求1.2_
  - [x] 10.1 记录任务创建的 `outputDir` 与校验失败原因
- [x] 11. 集成与端到端测试 _需求：需求1.2、需求1.3_
  - [x] 11.1 接口：`outputDir` 为空返回 400
  - [x] 11.2 接口：`outputDir` 不可写返回 400
  - [x] 11.3 接口：`outputDir` 有效返回任务信息
- [x] 12. 最终检查点 _需求：需求1.1、需求2.2、需求3.2_
  - [x] 12.1 前端：记住上次目录并默认选中
  - [x] 12.2 前端：取消目录选择不创建任务
  - [x] 12.3 后端：输出路径正确落盘

- [x] 13. 编写属性测试 _需求：需求1.1、需求1.2、需求1.3、需求2.1、需求2.2、需求3.1、需求3.2_
  - **属性1: 录制前必须选择保存目录**
  - **验证需求：需求1.1、需求1.2、需求1.3**
  - [x] 13.1 目录未选择时不允许创建任务
  - [x] 13.2 目录选择成功后必须带入请求参数
  - **属性2: 记住上次保存目录**
  - **验证需求：需求2.1、需求2.2**
  - [x] 13.3 创建成功后写入上次目录并下次默认显示
  - **属性3: 取消选择不创建任务**
  - **验证需求：需求3.1、需求3.2**
  - [x] 13.4 取消选择时不发送创建请求且列表无新增

## 注意事项
- 标记为未完成的任务可追踪，避免遗漏
- 任务引用需求可追溯，确保实现与验收一致
- 检查点采用增量验证，避免集中到最后
- 属性测试用于验证全局正确性，单元测试与集成测试用于局部与链路验证
